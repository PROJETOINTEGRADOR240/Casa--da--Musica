<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Faltas - Casa da Música</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css"> <!-- Link para o arquivo CSS externo -->
</head>
<body>

    <h1>Cadastro de Faltas</h1>

    <form id="form-falta" onsubmit="return cadastrarFalta(event)">
        <div class="form-group">
            <label for="idAluno">ID do Aluno:</label>
            <input type="number" id="idAluno" placeholder="ID Aluno" required>
            <label for="idProfessor">ID do Professor:</label>
            <input type="number" id="idProfessor" placeholder="ID Professor" required>
        </div>
        <div class="form-group">
            <label for="idDisciplina">ID da Disciplina:</label>
            <input type="number" id="idDisciplina" placeholder="ID Disciplina" required>
            <label for="dataFalta">Data:</label>
            <input type="date" id="dataFalta" required>
        </div>
        <button type="submit" id="submit-btn"><i class="fas fa-plus"></i> Cadastrar Falta</button>
        <button type="button" onclick="voltarPagina()">
            <i class="fas fa-arrow-left"></i> Voltar
        </button>
    </form>

    <div class="table-container">
        <h2>Lista de Faltas</h2>
        <table>
            <thead>
                <tr>
                    <th>ID da Falta</th>
                    <th>ID do Aluno</th>
                    <th>ID do Professor</th>
                    <th>ID da Disciplina</th>
                    <th>Data</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody id="faltas-tbody">
                <tr>
                    <td>1</td>
                    <td>123</td>
                    <td>456</td>
                    <td>789</td>
                    <td>2024-10-15</td>
                    <td>
                        <div class="action-buttons">
                            <button class="button-update" onclick="editarFalta(1)"><i class="fas fa-edit"></i> Atualizar</button>
                            <button class="button-delete" onclick="excluirFalta(1, this)"><i class="fas fa-trash"></i> Excluir</button>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>234</td>
                    <td>567</td>
                    <td>890</td>
                    <td>2024-10-14</td>
                    <td>
                        <div class="action-buttons">
                            <button class="button-update" onclick="editarFalta(2)"><i class="fas fa-edit"></i> Atualizar</button>
                            <button class="button-delete" onclick="excluirFalta(2, this)"><i class="fas fa-trash"></i> Excluir</button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        let faltas = [
            { id: 1, idAluno: 123, idProfessor: 456, idDisciplina: 789, dataFalta: '2024-10-15' },
            { id: 2, idAluno: 234, idProfessor: 567, idDisciplina: 890, dataFalta: '2024-10-14' }
        ]; // Array para armazenar as faltas

        // Função de validação do formulário
        function validarFormulario() {
            // Lógica de validação do formulário
            return true;
        }

        // Função para cadastrar ou atualizar a falta
        function cadastrarFalta(event) {
            event.preventDefault(); // Impede o envio padrão do formulário

            const id = document.getElementById('idAluno').value; // ID do Aluno como ID da falta
            const idProfessor = document.getElementById('idProfessor').value;
            const idDisciplina = document.getElementById('idDisciplina').value;
            const dataFalta = document.getElementById('dataFalta').value;

            const index = faltas.findIndex(f => f.id == id);
            if (index >= 0) {
                // Atualiza falta existente
                faltas[index] = { id: Number(id), idProfessor, idDisciplina, dataFalta };
            } else {
                // Cadastra nova falta
                const newId = faltas.length + 1;
                faltas.push({ id: newId, idAluno: Number(id), idProfessor, idDisciplina, dataFalta });
            }

            atualizarTabela();
            document.getElementById('form-falta').reset(); // Limpa o formulário
            document.getElementById('submit-btn').innerHTML = '<i class="fas fa-plus"></i> Cadastrar Falta';
        }

        function atualizarTabela() {
            const tbody = document.getElementById('faltas-tbody');
            tbody.innerHTML = ''; // Limpa a tabela

            faltas.forEach(falta => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${faixa.id}</td>
                    <td>${faixa.idAluno}</td>
                    <td>${faixa.idProfessor}</td>
                    <td>${faixa.idDisciplina}</td>
                    <td>${faixa.dataFalta}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="button-update" onclick="editarFalta(${faixa.id})"><i class="fas fa-edit"></i> Atualizar</button>
                            <button class="button-delete" onclick="excluirFalta(${faixa.id}, this)"><i class="fas fa-trash"></i> Excluir</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function editarFalta(id) {
            const falta = faltas.find(f => f.id === id);
            document.getElementById('idAluno').value = falta.idAluno;
            document.getElementById('idProfessor').value = falta.idProfessor;
            document.getElementById('idDisciplina').value = falta.idDisciplina;
            document.getElementById('dataFalta').value = falta.dataFalta;

            // Atualiza o botão de enviar para "Atualizar"
            document.getElementById('submit-btn').innerHTML = '<i class="fas fa-save"></i> Atualizar Falta';
        }

        // Função para excluir a falta (no front-end e no banco de dados)
        function excluirFalta(id, btn) {
            const confirmacao = confirm("Tem certeza que deseja excluir esta falta?");
            if (confirmacao) {
                // Remover falta do banco de dados
                fetch(`/excluir-falta/${id}`, {
                    method: 'DELETE',
                })
                .then(response => {
                    if (response.ok) {
                        alert("Falta excluída com sucesso!");

                        // Remover a linha da tabela no front-end
                        const row = btn.closest('tr');
                        row.remove();

                        // Remove a falta do array
                        faltas = faltas.filter(f => f.id !== id);
                    } else {
                        alert("Erro ao excluir a falta.");
                    }
                })
                .catch(error => {
                    console.error("Erro:", error);
                    alert("Ocorreu um erro ao tentar excluir a falta.");
                });
            }
        }

        function voltarPagina() {
            window.location.href = 'index.html'; // Redireciona para a página index.html
        }
    </script>
</body>
</html>


    





