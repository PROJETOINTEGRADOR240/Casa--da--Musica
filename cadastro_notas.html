<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Notas - Casa da Música</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"> <!-- Importando Font Awesome -->
    <link rel="stylesheet" href="style.css"> <!-- Link para o arquivo CSS externo -->
</head>
<body>

    <h1>Cadastro de Notas</h1>

    <form onsubmit="return validarFormulario()">
        <div class="form-group">
            <input type="number" name="id_aluno" placeholder="ID do Aluno" required id="id_aluno">
            <input type="number" name="id_professor" placeholder="ID do Professor" required id="id_professor">
        </div>
        <div class="form-group">
            <input type="number" name="id_disciplina" placeholder="ID da Disciplina" required id="id_disciplina">
            <input type="number" name="nota" placeholder="Nota" step="0.01" min="0" max="10" required id="nota">
        </div>
        <button type="submit" id="submit-btn"><i class="fas fa-plus"></i> Cadastrar Aluno</button>
        <button type="button" onclick="voltarPagina()">
            <i class="fas fa-arrow-left"></i> Voltar
        </button>
    </form>

    <div class="table-container">
        <h2>Lista de Notas</h2>
        <table>
            <thead>
                <tr>
                    <th>ID da Nota</th>
                    <th>ID do Aluno</th>
                    <th>ID do Professor</th>
                    <th>ID da Disciplina</th>
                    <th>Nota</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody id="notas-tbody">
                <tr>
                    <td>1</td>
                    <td>101</td>
                    <td>201</td>
                    <td>301</td>
                    <td>8.50</td>
                    <td class="action-buttons">
                        <button class="button-update" onclick="atualizarNota(1, this)"><i class="fas fa-edit"></i> Atualizar</button>
                        <button class="button-delete" onclick="excluirNota(1)"><i class="fas fa-trash"></i> Excluir</button>
                    </td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>102</td>
                    <td>202</td>
                    <td>302</td>
                    <td>9.00</td>
                    <td class="action-buttons">
                        <button class="button-update" onclick="atualizarNota(2, this)"><i class="fas fa-edit"></i> Atualizar</button>
                        <button class="button-delete" onclick="excluirNota(2)"><i class="fas fa-trash"></i> Excluir</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        let notas = [
            { id: 1, id_aluno: 101, id_professor: 201, id_disciplina: 301, nota: 8.50 },
            { id: 2, id_aluno: 102, id_professor: 202, id_disciplina: 302, nota: 9.00 }
        ];

        function validarFormulario() {
            // Lógica de validação do formulário
            return true;
        }

        function excluirNota(id) {
            if (confirm("Tem certeza que deseja excluir esta nota?")) {
                fetch(`/excluir-nota/${id}`, {
                    method: 'DELETE'
                })
                .then(response => {
                    if (response.ok) {
                        alert("Nota excluída com sucesso!");
                        removerNotaDaTabela(id);
                    } else {
                        alert("Erro ao excluir nota.");
                    }
                });
            }
        }

        function atualizarNota(id, btn) {
            const nota = notas.find(n => n.id === id);
            if (nota) {
                // Preenche o formulário com os dados da nota
                document.getElementById('id_aluno').value = nota.id_aluno;
                document.getElementById('id_professor').value = nota.id_professor;
                document.getElementById('id_disciplina').value = nota.id_disciplina;
                document.getElementById('nota').value = nota.nota;

                // Atualiza o botão de envio do formulário
                const submitBtn = document.getElementById('submit-btn');
                submitBtn.innerHTML = '<i class="fas fa-save"></i> Atualizar Nota';
                submitBtn.setAttribute('onclick', `atualizarNotaNoServidor(${id})`);
            }
        }

        function atualizarNotaNoServidor(id) {
            const notaAtualizada = {
                id_aluno: document.getElementById('id_aluno').value,
                id_professor: document.getElementById('id_professor').value,
                id_disciplina: document.getElementById('id_disciplina').value,
                nota: document.getElementById('nota').value
            };

            // Enviar dados atualizados para o servidor (substitua a URL pelo endpoint correto)
            fetch(`/atualizar-nota/${id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(notaAtualizada)
            })
            .then(response => {
                if (response.ok) {
                    alert("Nota atualizada com sucesso!");
                    // Atualiza a tabela no front-end
                    atualizarTabela();
                } else {
                    alert("Erro ao atualizar nota.");
                }
            });

            // Restaura o botão de envio do formulário
            const submitBtn = document.getElementById('submit-btn');
            submitBtn.innerHTML = '<i class="fas fa-plus"></i> Cadastrar Aluno';
            submitBtn.removeAttribute('onclick');
        }

        function atualizarTabela() {
            const tbody = document.getElementById('notas-tbody');
            tbody.innerHTML = ''; // Limpa a tabela

            notas.forEach((nota) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${nota.id}</td>
                    <td>${nota.id_aluno}</td>
                    <td>${nota.id_professor}</td>
                    <td>${nota.id_disciplina}</td>
                    <td>${nota.nota}</td>
                    <td class="action-buttons">
                        <button class="button-update" onclick="atualizarNota(${nota.id}, this)"><i class="fas fa-edit"></i> Atualizar</button>
                        <button class="button-delete" onclick="excluirNota(${nota.id})"><i class="fas fa-trash"></i> Excluir</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function removerNotaDaTabela(id) {
            notas = notas.filter(n => n.id !== id);
            atualizarTabela();
        }

        function voltarPagina() {
            window.location.href = 'index.html'; // Redireciona para a página index.html
        }
    </script>
</body>
</html>
